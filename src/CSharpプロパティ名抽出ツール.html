<!--
C# Property Name Filter Tool

Copyright (c) 2020 Sota Sasada

This software is released under the MIT License.
http://opensource.org/licenses/mit-license.php
-->
<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>C#プロパティ名抽出ツール</title>
        <style type="text/css">
            @media (prefers-color-scheme: light) {
                textarea {
                    background-color: whitesmoke;
                }
            }
            @media (prefers-color-scheme: dark) {
                body {
                    background-color: dimgray;
                    color: whitesmoke;
                }
                textarea {
                    background-color: gray;
                    color: whitesmoke;
                }
                ::placeholder {
                    color: black;
                }
            }
            textarea { 
                overflow: scroll;
                width: 100%;
                margin: 5px;
            }
            .textarea_container {
                display: flex;
                justify-content: center;
                height: 30em;
            }
            fieldset {
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <div>
            <h3>C#プロパティ名抽出ツール</h3>
            <div>
                <fieldset>
                    <input id="show_property_type_check_box" type="checkbox"/>型名を表示する
                    <input id="show_class_name_check_box" type="checkbox"/>クラス名を表示する
                </fieldset>
            </div>
            <div class="textarea_container">
                <textarea id="input_textarea" placeholder="ここにソースコードを貼り付けて下さい。"></textarea>
                <textarea id="output_textarea" placeholder="プロパティ名" readonly></textarea>
            </div>
        </div>
        <script type="text/javascript">
            const showPropertyTypeCheckBox = document.getElementById("show_property_type_check_box");
            const showClassNameCheckBox = document.getElementById('show_class_name_check_box');
            const inputTextArea = document.getElementById("input_textarea");
            const outputTextArea = document.getElementById("output_textarea");

            showPropertyTypeCheckBox.addEventListener('change', () => {
                filterText();
            });

            showClassNameCheckBox.addEventListener('change', () => {
                filterText();
            });

            inputTextArea.addEventListener('keyup', () => {
                filterText();
            })

            function filterText() {
                const propertyRegex = /(public|internal)\s*(sealed|virtual|override|^static)?\s*(\S+)\s*(\S+)/;

                let className = '';
                let content = '';

                const lines = inputTextArea.value.split(/\r\n|\r|\n/);

                lines.forEach(line => {

                    // 空文字なら処理を行わない
                    if(!line) {
                        return;
                    }

                    // メソッドなら処理を行わない
                    if (line.slice(-1) == ')') {
                        return;
                    }

                    const match = line.trim().match(propertyRegex);

                    if (match == null) {
                        return;
                    }

                    const type = match[3];
                    const name = match[4];

                    // 静的プロパティなら処理を行わない
                    if (type == 'static') {
                        return;
                    }

                    // クラス名ならクラス名を保持してコンティニューする
                    if (type == 'class') {
                        className += name;
                        return;
                    }

                    content += showPropertyTypeCheckBox.checked ? `${type}\t` : '';
                    content += name + '\n';
                });

                let header = showClassNameCheckBox.checked ? `クラス名\t${className}\n` : '';
                header += showPropertyTypeCheckBox.checked ? '型名\t' : '';
                header += 'プロパティ名\n';

                outputTextArea.value = header + content;
            }
        </script>
    </body>
</html>
